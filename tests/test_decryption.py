 # pylint: disable=line-too-long
from custom_components.candy.client.decryption import find_key


def test_find_key_1():
    response = bytes.fromhex("""
1D6F6C634E11190C121E1F2A001F0A19140B050F4E5816606C62654436002D043516071E19114F57445B4E4A6C636264442714184E584F5D4447616C6860492007010E270840574F5749406B6B60624F361044504E534F416B61656F4339193D0E405C485C4041606C626544311B2802020744504E535E5B4447616C6860493E2A07100F0040574F5649406B6B60624F32070B1A4E584F595649406B6B60624F35120F043F124F5744534E4A6C636264442D161E5D40574F5649406B6B60624F291212584E584F5D4447616C686049221616554856405D4F4A66666F684B241D125644504E524F416B61656F43261B1953405C485C4041606C6265442E191F5B4458445A4E4E60676F624E29111D5C4F5C405648406F67646F49231615514957445244466168646444241C12584B514F56404A67666B644F351F09070C4B514F56404A67666B644F221915324353495D444E6B60656B4F2903073A070D4B514F56404A67666B644F340E013208040E4F5C40545958524F416B61656F433B0E0E0F1203230840574F5649406B6B60624F2A03080D4E584F5C4447616C6860492B0F0E0A384E584F5D4447616C686049290F11320F1F16220344514E56434566676F6B442E05113908151F3E03124B514F56404A67666B644F250309050A3C1B3E1203120F4E584F5D4447616C68604939563544504E524F416B61656F433D223A4458445A4E4E60676F624E32513B495744524446616864644405190B274B514F56404A67666B644F13050E204353495D444E6B60656B4F1808092F445B4B5B4F4A6F6C6365402319053C4E5C43585C59444E6B60656B4F23120828445B4B5D4F4A6F6C636540000212384E5C435949416B686F634E233D3E090D0A445B4B5B4F4A6F6C6365402C3D350D1E03104B514F5053505D5D4041606C62654402010A1F122E44504E524F606C62116B6B14
""")
    key = find_key(response)

    assert key == "fbfjlbmmfklfaikm"


def test_find_key_2():
    response = bytes.fromhex("""
2F7C6B441B390C094C3C42093A023429764B1A403343714A6B3D503902342E073D535B6F086854653240386F2E0C23283714243F4B250A0D1A7313085D416B4C5E78686F6A3E191C570D662C1E0B657B76434361344071611A0454390C2026333D120E6F0368484A14443B44644114353503151E4D25084A026B016F416E4D485D53353F5C23163D562613774F53656D597B68441B0F1B071A73137D4F4F4A4B5D78431D4B251F1A592413774F337263787C6B4430683D104C3B50091F1A657B76414361344071611A0641280327282E263E11391B705A581A653C47646A6505311D00346A3E191A4C6B0B6F5D416B4C5E78686F6B2F153C5124546F5741767364534D403343714A7520423E3E022B35764B437C1B66756231401300041034133D1F12281B705A581A653C47646A650E24140F0956250A4A026B016F416E4D485D5333284A2F0C4A026B016F416E4D485D5322255C29133D486B0B6F5D416B4C5E78686F4B7B5A521A7B136160694E487603536F0368484A14443B4464413572764B437F1B6675623140133F59417D6365534D403343714A4A7C13774F53656D597B68441B384E4A026B016F416E4D485D53137A1B705A5B1A653C47646A65336C535B6F086854653240386F1F5A657B763F3401756854653240386F1F5272636E53506F3440711535434C
""")
    key = find_key(response)

    assert key == "TqaM9Jxh8I1MmcGA"


def test_find_key_error():
    response = bytes.fromhex("""
2F7C6B441B390C094C3C42093A023429764B1A403343714A6B3D503902342E073D535B6F086854653240386F2E0C23283714243F4B250A0D1A7313085D416B4C5E78686F6A3E191C570D662C1E0B657B76434361344071611A0454390C2026333D120E6F0368484A14443B44644114353503151E4D25084A026B016F416E4D485D53353F5C23163D562613774F53656D597B68441B0F1B071A73137D4F4F4A4B5D78431D4B251F1A592413774F337263787C6B4430683D104C3B50091F1A657B76414361344071611A0641280327282E263E11391B705A581A653C47646A6505311D00346A3E191A4C6B0B6F5D416B4C5E78686F6B2F153C5124546F5741767364534D403343714A7520423E3E022B35764B437C1B66756231401300041034133D1F12281B705A581A653C47646A650E24140F0956250A4A026B016F416E4D485D5333284A2F0C4A026B016F416E4D485D5322255C29133D486B0B6F5D416B4C5E78686F4B7B5A521A7B136160694E487603536F0368484A14443B4464413572764B437F1B6675623140133F59417D6365534D403343714A4A7C13774F53656D597B68441B384E4A026B016F416E4D485D53137A1B705A5B1A653C47646A65336C535B6F086854653240386F1F5A657B763F3401756854653240386F1F527263
""")
    key = find_key(response)

    assert key is None
